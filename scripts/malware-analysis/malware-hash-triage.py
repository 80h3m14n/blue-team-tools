import hashlib
import sys
import os

CHUNK_SIZE = 8192

def calculate_hash(filepath, algorithm):
    hash_func = hashlib.new(algorithm)
    with open(filepath, 'rb') as f:
        while chunk := f.read(CHUNK_SIZE):
            hash_func.update(chunk)
    return hash_func.hexdigest()

def print_help():
    print("Malware Hash Generator")
    print("----------------------")
    print("Usage:")
    print("  python mmain.py <file-name>")
    print("")
    print("Generates the following hashes:")
    print("  - MD5")
    print("  - SHA1")
    print("  - SHA256")
    print("")
    print("Example:")
    print("  python mmain.py suspicious.exe")

def main():
    if len(sys.argv) != 2:
        print_help()
        sys.exit(1)

    filepath = sys.argv[1]

    if not os.path.isfile(filepath):
        print(f"[!] Error: File '{filepath}' not found.")
        sys.exit(1)

    try:
        print(f"\n[*] Calculating hashes for: {filepath}\n")

        md5 = calculate_hash(filepath, "md5")
        sha1 = calculate_hash(filepath, "sha1")
        sha256 = calculate_hash(filepath, "sha256")

        print("Results:")
        print("--------")
        print(f"MD5:     {md5}")
        print(f"SHA1:    {sha1}")
        print(f"SHA256:  {sha256}")

    except KeyboardInterrupt:
        print("\n[!] Process interrupted by user (Ctrl+C). Exiting safely.")
        sys.exit(1)

    except Exception as e:
        print(f"[!] An error occurred: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()
